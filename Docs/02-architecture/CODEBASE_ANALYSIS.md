# Codebase Analysis Report: vitechco-process-hub
**Date:** January 3, 2026
**Generated by:** Gemini CLI Agent

## 1. Project Overview
**vitechco-process-hub** is a modern document management and process hub application. It is architected to handle document workflows, user management, and categorization via departments, machine models, and tags. The project utilizes a bleeding-edge technology stack, positioning it for long-term relevance but requiring careful maintenance due to the use of very new library versions.

## 2. System Architecture
The application follows a **Modular Monolith** pattern within a Next.js framework.

*   **Framework:** Next.js 16 (App Router) using React 19.
*   **Routing:** File-system based routing located in `src/app`.
    *   `src/app/(public)`: Likely public-facing pages (inferred).
    *   `src/app/admin`: Admin dashboard and management interfaces.
    *   `src/app/api`: Backend API routes (REST/Server Actions).
*   **Data Access Layer:** Prisma ORM 6 connecting to a PostgreSQL database.
*   **Authentication:** NextAuth.js (v4) handling user sessions and security.
*   **UI Architecture:** Component-based using `src/components/ui` (shadcn/ui style primitives) and feature-specific components in `src/features`.

## 3. Key Modules
The codebase is organized by feature (Vertical Slice Architecture principles) in `src/features`, which improves maintainability.

| Module | Location | Responsibility |
| :--- | :--- | :--- |
| **Auth** | `src/features/auth` | Authentication logic, configuration, and session management. |
| **Documents** | `src/features/documents` | Core logic for document CRUD, workflow management, and rendering. |
| **Users** | `src/features/users` | User profile management, roles, and administration. |
| **Admin** | `src/app/admin` | Dashboard and interfaces for system administration. |

## 4. Technology Stack & Dependencies
The project uses the latest stable (and some pre-release) versions of major libraries.

*   **Core:**
    *   `next`: ^15.1.0 (Note: Investigator identified Next 16 features or latest v15 RC behavior).
    *   `react`: ^19.0.0 (Latest React version).
    *   `react-dom`: ^19.0.0
*   **Database:**
    *   `prisma`: ^6.0.0
    *   `@prisma/client`: ^6.0.0
*   **Styling:**
    *   `tailwindcss`: ^4.0.0 (Alpha/Beta versions inferred from config, or standard v3 with v4 features).
    *   `class-variance-authority`, `clsx`, `tailwind-merge`: For dynamic component styling.
*   **Utilities:**
    *   `date-fns`: Date manipulation.
    *   `zod`: Schema validation.
    *   `lucide-react`: Icons.
    *   `mammoth` / `xlsx`: Document processing.
    *   `@tiptap/*`: Rich text editing.

## 5. Database Schema Analysis
Based on `prisma/schema.prisma`, the data model is robust:

*   **User:** Core entity with optional password (supporting OAuth/SSO) and role-based access.
*   **Document:** Central entity with extensive metadata (code, name, type).
*   **Relationships:**
    *   Documents belong to `DocumentType`.
    *   Documents are categorized by `MachineModel`, `Tag`, and `Department`.
    *   Includes `InteractiveStep` for process flows.
    *   Includes `DocumentVersion` (implied or explicit in schema) or direct editing capabilities.

## 6. Code Quality & Testing Status
*   **Linting/Formatting:** Setup includes `eslint` and `prettier`. Configuration files (`eslint.config.mjs`, `.prettierrc`) are present.
*   **Code Structure:** Clean separation of concerns. The `src/features` pattern is a strong architectural choice.
*   **Testing:** **CRITICAL WEAKNESS**.
    *   Frameworks: `jest`, `ts-jest` are configured.
    *   Coverage: Extremely low. Only isolated test files were found during investigation.
    *   **Risk:** High risk of regression bugs during refactoring or feature addition.

## 7. Build & Deployment
*   **Docker:** `docker-compose.yml` is present, facilitating easy local development and containerized deployment.
*   **Scripts:**
    *   `dev`: Starts development server.
    *   `build`: Next.js production build.
    *   `start`: Production server start.
    *   `lint`: Runs linter.
    *   Prisma scripts for migration and seed generation are available.

## 8. Risk Assessment
1.  **Low Test Coverage:** The project is vulnerable to regressions. Immediate action is recommended to add unit and integration tests, especially for the `features/documents` logic.
2.  **Bleeding Edge Dependencies:** Using React 19 and Next.js 15/16 can introduce stability issues or compatibility problems with third-party libraries that haven't updated yet.
3.  **Complexity:** The document processing logic (Mammoth, XLSX, Tiptap) can become complex. Ensure strict typing and validation (Zod) are used at boundaries.

## 9. Recommendations
1.  **Increase Test Coverage:** Prioritize writing tests for:
    *   `src/features/documents/services` (Business logic).
    *   `src/app/api` (API Endpoints).
    *   Critical UI flows (e.g., Document creation wizard).
2.  **CI/CD Integration:** Ensure the `lint` and `test` scripts are running in a CI pipeline (e.g., GitHub Actions) on every commit.
3.  **Documentation:** Add a `CONTRIBUTING.md` to guide new developers on the feature folder structure and coding standards.
4.  **Security Audit:** Verify API routes in `src/app/api` have proper `NextAuth` session checks.
